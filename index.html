<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>生日快樂噢</title>
  <style>
    * { margin:0; padding:0; box-sizing:border-box; }
    html, body { width:100%; height:100%; overflow:hidden; background:#000; font-family:'Segoe UI',sans-serif; }

    #background { position:fixed; top:0; left:0; width:100%; height:100%; z-index:0; pointer-events:none; }
    .star { position:absolute; width:2px; height:2px; background:#fff; border-radius:50%; animation:twinkle 2s infinite ease-in-out; }
    @keyframes twinkle {0%,100%{opacity:0.2;}50%{opacity:1;}}

    .meteor { position:absolute; width:120px; height:2px; background:linear-gradient(to left, #fff, transparent); transform:rotate(45deg); animation:shoot 3s linear infinite; pointer-events:none; }
    @keyframes shoot { 0%{opacity:1;}100%{opacity:0; transform:translate(500px,500px) rotate(45deg);} }

    .special-meteor {
      background: radial-gradient(circle, rgba(255,255,255,0.2) 40%, rgba(255,255,255,0) 120%);
      width: 20px; height: 20px; border-radius: 50%;
      position: absolute;
      box-shadow: 0 0 6px rgba(255,255,255,0.4);
      animation: sparkle 6s ease-in-out infinite;
      pointer-events:auto; cursor:pointer;
    }
    @keyframes sparkle {
      0%,100%{ transform: scale(1); opacity: 0.2; }
      50%{ transform: scale(1.2); opacity: 0.4; }
    }

    #secretScreen {
      display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: radial-gradient(ellipse at center, #222 0%, #000 100%);
      backdrop-filter: blur(8px);
      z-index: 9999; color: white;
      justify-content: center; align-items: center; flex-direction: column;
      animation: softFade 1s ease-in-out forwards;
    }

    #secretMessage {
      font-size: 1.6rem;
      white-space: pre-wrap;
      text-align: center;
      padding: 2rem;
      line-height: 2.4rem;
      max-width: 90%;
      font-family: 'Courier New', monospace;
      color: #fefefe;
      text-shadow: 0 0 6px #ccc;
      position: relative;
    }

    .cursor {
      display: inline-block;
      width: 1px;
      height: 1.6rem;
      background: #fff;
      animation: blinkCursor 1s step-start infinite;
      vertical-align: bottom;
      margin-left: 2px;
    }

    @keyframes blinkCursor {
      50% { opacity: 0; }
    }

    @keyframes softFade {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    #fireworks { position:fixed; top:0; left:0; width:100%; height:100%; z-index:1; pointer-events:none; display:none; }

    .container { position:fixed; top:50%; left:50%; transform:translate(-50%,-50%); z-index:2; display:flex; flex-direction:column; align-items:center; pointer-events:auto; }
    #giftBox { cursor:pointer; }
    #hint { margin-top:8px; font-size:1.2rem; color:#ffeb3b; animation:blink 1.5s infinite; pointer-events:none; }
    @keyframes blink {0%,100%{opacity:1;}50%{opacity:0.3;}}

    #messageContainer { margin-top:20px; display:flex; flex-direction:column; align-items:center; }
    .message {  color: #fff;font-size:1.8rem; white-space:nowrap; opacity:0; animation:float 4s ease-in-out, glow 2s ease-in-out infinite alternate; }
    @keyframes float {0%{transform:translateY(10px);opacity:0;}10%,90%{opacity:1;}100%{transform:translateY(-10px);opacity:0;} }
    @keyframes glow {from{text-shadow:0 0 5px #fff,0 0 10px #ff69b4;}to{text-shadow:0 0 30px #ff66cc,0 0 40px #ffccff;}}

    .final {  color: #fff;font-size:2.2rem; font-weight:bold; animation:finalZoom 1s ease-in-out infinite alternate, glow 3s ease-in-out infinite alternate; }
    @keyframes finalZoom {from{transform:scale(1);}to{transform:scale(1.5);} }
  </style>
</head>
<body>
  <div id="background"></div>
  <div id="secretScreen">
    <div id="secretMessage"></div>
  </div>
  <canvas id="fireworks"></canvas>
  <div class="container">
    <div id="giftBox">
      <img src="gift.gif" width="160" alt="禮物盒">
      <div id="hint">點🎁 開聲音開聲音!!</div>
    </div>
    <div id="messageContainer"></div>
    <audio id="bgMusic" src="birthday-song.mp3" loop></audio>
    </div>

  <script>
    const messageContainer = document.getElementById("messageContainer");
    const secretScreen = document.getElementById("secretScreen");
    const secretMessage = document.getElementById("secretMessage");

    const specialMeteors = [];
    for (let i = 0; i < 3; i++) {
      const meteor = document.createElement("div");
      meteor.className = "special-meteor";
      meteor.style.top = `${Math.random() * 80 + 10}%`;
      meteor.style.left = `${Math.random() * 80 + 10}%`;
      meteor.addEventListener("click", () => {
        document.getElementById("bgMusic").pause();
        showSecretMessage();
      });
      document.body.appendChild(meteor);
      specialMeteors.push(meteor);
    }

    // Secret typing message content
    const messageSegments = [
      "Surprise~~",
      "無論是甜品還是這個，\n都是我一次弄哦~",
      "別嫌棄吖~ 不好吃也得吃!! 嘻嘻~",
      "希望你喜歡 💖",
      "如果有一天過得不如意了，\n回來這裡看看唄~",
      "噢對了... 生日快樂 ✨",
    ];

    let currentSegment = 0;

    function showSecretMessage() {
      secretScreen.style.display = "flex";
      secretMessage.innerHTML = "";
      currentSegment = 0;
      typeLines();
    }

    function typeLines() {
      if (currentSegment >= messageSegments.length) {
        // 結束後顯示一個提示（可加按鈕返回主畫面）
        const done = document.createElement("div");
        done.textContent = "\n（點擊畫面即可關閉）";
        done.style.marginTop = "2rem";
        done.style.opacity = 0.7;
        done.style.fontSize = "1rem";
        secretMessage.appendChild(done);
        secretScreen.addEventListener("click", () => {
          secretScreen.style.display = "none";
          document.getElementById("bgMusic").play();
        });
        return;
      }

      const text = messageSegments[currentSegment];
      let index = 0;
      const lineDiv = document.createElement("div");
      const cursor = document.createElement("span");
      cursor.className = "cursor";
      lineDiv.appendChild(cursor);
      secretMessage.appendChild(lineDiv);

      const typer = setInterval(() => {
        if (index < text.length) {
          const char = document.createTextNode(text[index]);
          lineDiv.insertBefore(char, cursor);
          index++;
        } else {
          clearInterval(typer);
          lineDiv.removeChild(cursor);
          currentSegment++;
          setTimeout(typeLines, 1000); // 下一段延遲
        }
      }, 60); // 打字速度（你可改成更快/慢）
    }

    // 原始 giftbox 動畫觸發部分（保留）
    document.getElementById("giftBox").addEventListener("click", () => {
      document.getElementById("bgMusic").play();
      document.getElementById("fireworks").style.display = "block";
      const messages = [
        "Vanise，生日快樂吖！",
        "又老了一歲咯~",
        "能夠認識你是上天給的禮物",
        "願君 歲歲無虞，長安長樂；",
        "昭昭如願，年年安瀾。",
        "早得良人，共賞春風。",
      ];
      messages.forEach((msg, i) => {
        const div = document.createElement("div");
        div.className = i === messages.length - 1 ? "final" : "message";
        div.textContent = msg;
        setTimeout(() => {
          messageContainer.appendChild(div);
        }, i * 2000);
      });
    });

    // 隨機星星背景生成（保留）
    for (let i = 0; i < 100; i++) {
      const star = document.createElement("div");
      star.className = "star";
      star.style.top = `${Math.random() * 100}%`;
      star.style.left = `${Math.random() * 100}%`;
      document.getElementById("background").appendChild(star);
    }

    // 隨機流星背景生成（保留）
    for (let i = 0; i < 20; i++) {
      const meteor = document.createElement("div");
      meteor.className = "meteor";
      meteor.style.top = `${Math.random() * 100}%`;
      meteor.style.left = `${Math.random() * 100}%`;
      meteor.style.animationDelay = `${Math.random() * 5}s`;
      document.body.appendChild(meteor);
    }
  </script>
</body>
</html>
